<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Vocab Ultimate</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background:#f4f6fb;
}

header{
  position:sticky;
  top:0;
  background:white;
  padding:14px 16px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
  z-index:10;
}

h1{margin:0;font-size:20px}

.controls{
  display:flex;
  gap:10px;
  margin-top:10px;
}

button{
  border:none;
  border-radius:10px;
  padding:8px 12px;
  font-size:14px;
  cursor:pointer;
}

.import{background:#1e88e5;color:white}
.export{background:#6a5acd;color:white}
.starBtn{background:#fbc02d}
.pronBtn{background:#26a69a;color:white}
.refreshBtn{background:#90a4ae;color:white}
.addBtn{background:#42a5f5;color:white}

main{padding:14px}

.card{
  background:white;
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
}

.word{font-weight:700;font-size:18px}
.ipa{color:#26a69a;margin-top:2px}
.meaning{color:#444;margin-top:4px}

.icons{
  margin-top:8px;
  display:flex;
  gap:10px;
}

.iconBtn{
  border:none;
  border-radius:8px;
  padding:6px 8px;
  background:#eef3ff;
  cursor:pointer;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  align-items:center;
  justify-content:center;
}

.modalBox{
  background:white;
  border-radius:14px;
  padding:16px;
  width:92%;
  max-width:420px;
}

.modalBox input, .modalBox textarea{
  width:100%;
  margin-bottom:8px;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

.row{display:flex;gap:8px;margin-top:6px}

.exampleBlock{
  margin-top:6px;
  background:#f7f9ff;
  padding:8px;
  border-radius:8px;
}

</style>
</head>

<body>

<header>
  <h1>üìò My Vocab</h1>

  <div class="controls">
    <button class="import" onclick="importCSV()">Import</button>
    <button class="export" onclick="exportCSV()">Export</button>
    <button class="starBtn" onclick="toggleFav()">‚≠ê</button>
    <button class="pronBtn" onclick="openPron()">Pron</button>
    <button class="refreshBtn" onclick="clearSearch()">üîÑ</button>
    <button class="addBtn" onclick="openModal()">Ôºã</button>
  </div>

  <input id="search" placeholder="Search..." 
         style="width:100%;margin-top:8px;padding:8px;border-radius:8px;border:1px solid #ccc"
         oninput="render()">
</header>

<main id="list"></main>

<div class="modal" id="modal">
  <div class="modalBox">

    <input id="mWord" placeholder="Word" oninput="autoIPA()">
    <input id="mIPA" placeholder="IPA">
    <input id="mMeaning" placeholder="Meaning">

    <div class="exampleBlock">
      <input id="mEx1" placeholder="Example 1">
      <input id="mEx1IPA" placeholder="IPA Ex1">
      <input id="mEx1Tr" placeholder="Translation Ex1">
      <div class="row">
        <button onclick="speak(mEx1.value)">üîä</button>
      </div>
    </div>

    <div class="exampleBlock">
      <input id="mEx2" placeholder="Example 2">
      <input id="mEx2IPA" placeholder="IPA Ex2">
      <input id="mEx2Tr" placeholder="Translation Ex2">
      <div class="row">
        <button onclick="speak(mEx2.value)">üîä</button>
      </div>
    </div>

    <div class="row">
      <button onclick="save()">Save</button>
      <button onclick="remove()">Delete</button>
      <button onclick="closeModal()">Cancel</button>
    </div>

  </div>
</div>

<script>
let data=JSON.parse(localStorage.getItem("vocab")||"[]")
let editIndex=null
let showFav=false

function render(){
  const q=search.value.toLowerCase()
  list.innerHTML=""
  data.forEach((v,i)=>{
    if(showFav && !v.fav) return
    if(q && !v.word.toLowerCase().includes(q) && !v.meaning.toLowerCase().includes(q)) return

    const d=document.createElement("div")
    d.className="card"

    d.innerHTML=`
      <div class="word">${v.word}</div>
      <div class="ipa">${v.ipa||""}</div>
      <div class="meaning">${v.meaning||""}</div>

      <div class="icons">
        <button class="iconBtn" onclick="speak('${v.word}')">üîä</button>
        <button class="iconBtn" onclick="edit(${i})">‚úèÔ∏è</button>
        <button class="iconBtn" onclick="toggleStar(${i})">${v.fav?"‚≠ê":"‚òÜ"}</button>
      </div>
    `
    list.appendChild(d)
  })
}

function openModal(){
  editIndex=null
  modal.style.display="flex"
}

function closeModal(){
  modal.style.display="none"
}

function save(){
  const v={
    word:mWord.value,
    ipa:mIPA.value,
    meaning:mMeaning.value,
    ex1:mEx1.value,
    ex1ipa:mEx1IPA.value,
    ex1tr:mEx1Tr.value,
    ex2:mEx2.value,
    ex2ipa:mEx2IPA.value,
    ex2tr:mEx2Tr.value,
    fav:false
  }
  if(editIndex===null) data.push(v)
  else data[editIndex]=v
  persist()
  closeModal()
  render()
}

function edit(i){
  editIndex=i
  const v=data[i]
  mWord.value=v.word
  mIPA.value=v.ipa
  mMeaning.value=v.meaning
  mEx1.value=v.ex1
  mEx1IPA.value=v.ex1ipa
  mEx1Tr.value=v.ex1tr
  mEx2.value=v.ex2
  mEx2IPA.value=v.ex2ipa
  mEx2Tr.value=v.ex2tr
  modal.style.display="flex"
}

function remove(){
  if(editIndex!=null){
    data.splice(editIndex,1)
    persist()
    closeModal()
    render()
  }
}

function toggleStar(i){
  data[i].fav=!data[i].fav
  persist()
  render()
}

function toggleFav(){
  showFav=!showFav
  render()
}

function clearSearch(){
  search.value=""
  render()
}

function persist(){
  localStorage.setItem("vocab",JSON.stringify(data))
}

function speak(t){
  if(!t) return
  speechSynthesis.speak(new SpeechSynthesisUtterance(t))
}

function autoIPA(){
  const w=mWord.value.toLowerCase()
  if(!w) return
  fetch("https://api.dictionaryapi.dev/api/v2/entries/en/"+w)
    .then(r=>r.json())
    .then(j=>{
      if(j[0]?.phonetics?.[0]?.text){
        mIPA.value=j[0].phonetics[0].text
      }
    }).catch(()=>{})
}

function importCSV(){
  const i=document.createElement("input")
  i.type="file"
  i.accept=".csv"
  i.onchange=e=>{
    const f=e.target.files[0]
    const r=new FileReader()
    r.onload=()=>{
      const lines=r.result.split(/\r?\n/).filter(l=>l.trim())
      data=[]
      lines.slice(1).forEach(line=>{
        const c=line.split(",")
        data.push({
          word:c[0]||"",
          ipa:c[1]||"",
          meaning:c[2]||"",
          ex1:c[3]||"",
          ex1ipa:c[4]||"",
          ex1tr:c[5]||"",
          ex2:c[6]||"",
          ex2ipa:c[7]||"",
          ex2tr:c[8]||"",
          fav:false
        })
      })
      persist()
      render()
      alert("Import success")
    }
    r.readAsText(f)
  }
  i.click()
}

function exportCSV(){
  let csv="word,ipa,meaning,example1,ipa1,tr1,example2,ipa2,tr2\n"
  data.forEach(v=>{
    csv+=`${v.word},${v.ipa},${v.meaning},${v.ex1},${v.ex1ipa},${v.ex1tr},${v.ex2},${v.ex2ipa},${v.ex2tr}\n`
  })
  const a=document.createElement("a")
  a.href=URL.createObjectURL(new Blob([csv]))
  a.download="vocab.csv"
  a.click()
}

render()
</script>

</body>
</html>