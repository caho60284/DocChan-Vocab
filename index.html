<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<title>My Vocab Ultra</title>

<style>
body{
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
margin:0;
background:#f3f4f6;
}

header{
padding:16px;
}

h1{
margin:0;
font-size:26px;
}

.count{
color:#666;
margin-top:4px;
}

.toolbar{
display:flex;
flex-wrap:wrap;
gap:10px;
padding:0 16px 10px;
}

.btn{
border:none;
padding:10px 14px;
border-radius:10px;
font-weight:600;
color:#fff;
cursor:pointer;
}

.import{background:#3b82f6}
.export{background:#8b5cf6}
.delete{background:#ef4444}
.fav{background:#f59e0b}
.pron{background:#38bdf8}
.refresh{background:#22c55e}
.add{background:#94a3b8}

.search{
padding:0 16px 12px;
}

.search input{
width:100%;
padding:10px;
border-radius:10px;
border:1px solid #ccc;
font-size:16px;
}

.card{
background:#fff;
margin:10px 16px;
padding:14px;
border-radius:14px;
box-shadow:0 2px 6px rgba(0,0,0,0.06);
position:relative;
}

.word{
font-weight:700;
font-size:18px;
}

.ipa{
color:#666;
margin-top:2px;
}

.meaning{
margin-top:2px;
}

.icons{
margin-top:6px;
font-size:18px;
}

.star{
position:absolute;
right:12px;
top:12px;
font-size:20px;
cursor:pointer;
}

.pencil{
position:absolute;
right:40px;
top:12px;
font-size:18px;
cursor:pointer;
}

/* modal */
.modal{
position:fixed;
top:0;
left:0;
right:0;
bottom:0;
background:rgba(0,0,0,0.3);
display:none;
align-items:center;
justify-content:center;
z-index:999;
}

.modal-content{
background:#fff;
padding:16px;
border-radius:14px;
width:90%;
max-width:420px;
max-height:90vh;
overflow:auto;
}

.modal input, .modal textarea{
width:100%;
padding:8px;
margin-bottom:8px;
border-radius:8px;
border:1px solid #ccc;
font-size:14px;
}

.row{
display:flex;
gap:8px;
margin-top:8px;
}

.row button{
flex:1;
border:none;
padding:10px;
border-radius:10px;
color:#fff;
font-weight:600;
}

.save{background:#3b82f6}
.del{background:#ef4444}
.cancel{background:#9ca3af}
.hear{background:#22c55e}
.test{background:#3b82f6}

.pron-ipa{
text-align:center;
margin:8px 0;
color:#555;
}
</style>
</head>

<body>

<header>
<h1>ğŸ“˜ My Vocab Ultra</h1>
<div class="count" id="count">Total vocabulary: 0</div>
</header>

<div class="toolbar">
<button class="btn import">ğŸ“¥ Import</button>
<button class="btn export">ğŸ“¤ Export</button>
<button class="btn delete">ğŸ§¨ Delete All</button>

<button class="btn fav">â­ Favorites</button>
<button class="btn pron" onclick="openPron()">ğŸ¤ Pronunciation</button>
<button class="btn refresh" onclick="render()">ğŸ”„</button>
<button class="btn add" onclick="openEdit()">ï¼‹</button>
</div>

<div class="search">
<input id="searchBox" placeholder="Search word or meaning..." oninput="render()">
</div>

<div id="list"></div>

<!-- EDIT -->
<div class="modal" id="editModal">
<div class="modal-content">

<input id="eWord" placeholder="Word">
<input id="eIPA" placeholder="IPA">
<input id="eMeaning" placeholder="Meaning">

<textarea id="eEx1" placeholder="Example 1"></textarea>
<input id="eIPA1" placeholder="IPA Example 1">
<textarea id="eTr1" placeholder="Translation 1"></textarea>

<textarea id="eEx2" placeholder="Example 2"></textarea>
<input id="eIPA2" placeholder="IPA Example 2">
<textarea id="eTr2" placeholder="Translation 2"></textarea>

<div class="row">
<button class="hear" onclick="speak(eEx1.value)">ğŸ”Š Ex1</button>
<button class="hear" onclick="speak(eEx2.value)">ğŸ”Š Ex2</button>
</div>

<div class="row">
<button class="save" onclick="saveEdit()">Save</button>
<button class="del" onclick="deleteWord()">Delete</button>
<button class="cancel" onclick="closeEdit()">Cancel</button>
</div>

</div>
</div>

<!-- PRON -->
<div class="modal" id="pronModal">
<div class="modal-content">

<input id="pronWord" placeholder="Type word"
oninput="lookupIPA()"
onkeyup="if(event.key==='Enter') lookupIPA()">

<div id="pronIPA" class="pron-ipa"></div>

<div class="row">
<button class="hear" onclick="speak(pronWord.value)">Hear</button>
<button class="test" onclick="startRec()">Test</button>
<button class="cancel" onclick="closePron()">Close</button>
</div>

</div>
</div>

<script>

let data=JSON.parse(localStorage.getItem("vocab")||"[]");
let editingIndex=null;

function saveLS(){
localStorage.setItem("vocab",JSON.stringify(data));
}

function render(){
const q=searchBox.value.toLowerCase();
list.innerHTML="";
count.innerHTML="Total vocabulary: "+data.length;

data.filter(v=>
v.word.toLowerCase().includes(q)||
v.meaning.toLowerCase().includes(q)
).forEach((v,i)=>{

const div=document.createElement("div");
div.className="card";

div.innerHTML=`
<div class="word">${v.word}</div>
<div class="ipa">${v.ipa||""}</div>
<div class="meaning">${v.meaning||""}</div>

<div class="icons">
ğŸ”Š ğŸ¢ âœï¸
</div>

<div class="pencil" onclick="openEdit(${i})">âœï¸</div>
<div class="star" onclick="toggleFav(${i})">${v.fav?"â­":"â˜†"}</div>
`;

list.appendChild(div);
});
}

function toggleFav(i){
data[i].fav=!data[i].fav;
saveLS();
render();
}

function openEdit(i=null){
editModal.style.display="flex";
editingIndex=i;

if(i!=null){
const v=data[i];
eWord.value=v.word||"";
eIPA.value=v.ipa||"";
eMeaning.value=v.meaning||"";
eEx1.value=v.ex1||"";
eIPA1.value=v.ipa1||"";
eTr1.value=v.tr1||"";
eEx2.value=v.ex2||"";
eIPA2.value=v.ipa2||"";
eTr2.value=v.tr2||"";
}else{
eWord.value="";
eIPA.value="";
eMeaning.value="";
eEx1.value="";
eIPA1.value="";
eTr1.value="";
eEx2.value="";
eIPA2.value="";
eTr2.value="";
}
}

function closeEdit(){
editModal.style.display="none";
}

function saveEdit(){
const obj={
word:eWord.value,
ipa:eIPA.value,
meaning:eMeaning.value,
ex1:eEx1.value,
ipa1:eIPA1.value,
tr1:eTr1.value,
ex2:eEx2.value,
ipa2:eIPA2.value,
tr2:eTr2.value,
fav:false
};

if(editingIndex!=null){
data[editingIndex]=obj;
}else{
data.push(obj);
}

saveLS();
render();
closeEdit();
}

function deleteWord(){
if(editingIndex!=null){
data.splice(editingIndex,1);
saveLS();
render();
closeEdit();
}
}

function speak(t){
if(!t)return;
speechSynthesis.cancel();
speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}

function openPron(){
pronModal.style.display="flex";
pronWord.value="";
pronIPA.innerHTML="";
}

function closePron(){
pronModal.style.display="none";
}

function lookupIPA(){
const w=pronWord.value.toLowerCase().trim();
const found=data.find(v=>v.word.toLowerCase()==w);
pronIPA.innerHTML=found?found.ipa:"";
}

function startRec(){
if(!('webkitSpeechRecognition'in window))return;

const rec=new webkitSpeechRecognition();
rec.lang="en-US";

rec.onresult=e=>{
const said=e.results[0][0].transcript.toLowerCase();
const target=pronWord.value.toLowerCase();

if(said==target){
alert("âœ” Correct");
}else{
alert("âœ˜ "+said);
}
};

rec.start();
}

render();
</script>

</body>
</html>