<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>My Vocab Ultra</title>

<style>
body{
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
background:#f2f4f7;
margin:0;
}

.container{
max-width:700px;
margin:auto;
padding:16px;
}

h1{margin:0;font-size:28px;}
.total{color:#666;margin-bottom:12px;}

.btnrow{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-bottom:12px;
}

.btn{
border:none;
padding:10px 14px;
border-radius:10px;
font-size:14px;
font-weight:600;
color:#fff;
cursor:pointer;
}

.import{background:#2f80ed;}
.export{background:#9b51e0;}
.delete{background:#eb5757;}
.fav{background:#f2994a;}
.refresh{background:#27ae60;}
.pron{background:#56ccf2;}
.plus{background:#bfc8d6;color:#333;}

.search{
width:100%;
padding:12px;
border-radius:12px;
border:1px solid #ccc;
font-size:16px;
box-sizing:border-box;
margin-bottom:14px;
}

.card{
background:#fff;
border-radius:14px;
padding:14px;
margin-bottom:12px;
box-shadow:0 2px 6px rgba(0,0,0,0.05);
position:relative;
}

.word{font-size:20px;font-weight:700;}
.meaning{margin-top:4px;}

.icons{
margin-top:6px;
font-size:18px;
}

.star{
position:absolute;
right:14px;
top:14px;
font-size:20px;
cursor:pointer;
color:#ccc;
}

.star.active{color:#f2c94c;}

.edit{
position:absolute;
right:44px;
top:14px;
font-size:18px;
cursor:pointer;
color:#999;
}

.modal{
position:fixed;
top:0;left:0;right:0;bottom:0;
background:rgba(0,0,0,0.3);
display:none;
align-items:center;
justify-content:center;
}

.modalbox{
background:#fff;
padding:16px;
border-radius:14px;
width:92%;
max-width:500px;
}

.input{
width:100%;
padding:10px;
border-radius:10px;
border:1px solid #ccc;
margin-bottom:8px;
font-size:15px;
box-sizing:border-box;
}

.rowbtn{display:flex;gap:10px;margin-top:10px;}
.save{background:#2f80ed;}
.cancel{background:#bfc8d6;color:#333;}
</style>
</head>

<body>
<div class="container">

<h1>üìò My Vocab Ultra</h1>
<div class="total" id="total"></div>

<div class="btnrow">
<button class="btn import" onclick="importCSV()">üì• Import</button>
<button class="btn export" onclick="exportCSV()">üì§ Export</button>
<button class="btn delete" onclick="deleteAll()">üß® Delete All</button>
<button class="btn fav" onclick="toggleFavView()">‚≠ê Favorites</button>
<button class="btn refresh" onclick="refreshList()">üîÑ</button>
<button class="btn pron" onclick="openPron()">üé§ Pronunciation</button>
<button class="btn plus" onclick="openAdd()">Ôºã</button>
</div>

<input class="search" id="search" placeholder="Search word or meaning..." oninput="render()">

<div id="list"></div>

</div>

<!-- ADD -->
<div class="modal" id="modal">
<div class="modalbox">
<input class="input" id="m_word" placeholder="Word">
<input class="input" id="m_meaning" placeholder="Meaning">
<div class="rowbtn">
<button class="btn save" onclick="saveWord()">Save</button>
<button class="btn cancel" onclick="closeModal()">Cancel</button>
</div>
</div>
</div>

<!-- PRON -->
<div class="modal" id="pronModal">
<div class="modalbox">
<input class="input" id="pronInput" placeholder="Type word">
<div class="rowbtn">
<button class="btn pron" onclick="hearPron()">Hear</button>
<button class="btn save" onclick="testPron()">Test</button>
<button class="btn cancel" onclick="closePron()">Close</button>
</div>
<div id="pronResult" style="margin-top:10px;font-weight:600;"></div>
</div>
</div>

<script>
let vocab=JSON.parse(localStorage.getItem("vocab")||"[]");
let favOnly=false;
let editIndex=-1;

function saveStorage(){
localStorage.setItem("vocab",JSON.stringify(vocab));
}

function render(){
let s=document.getElementById("search").value.toLowerCase();
let list=document.getElementById("list");
list.innerHTML="";
let arr=vocab.filter(v=>
(!favOnly||v.fav)&&
(v.word.toLowerCase().includes(s)||
v.meaning.toLowerCase().includes(s))
);
arr.forEach((v,i)=>{
let idx=vocab.indexOf(v);
let d=document.createElement("div");
d.className="card";
d.innerHTML=`
<div class="star ${v.fav?'active':''}" onclick="toggleFav(${idx})">‚òÖ</div>
<div class="edit" onclick="editWord(${idx})">‚úèÔ∏è</div>
<div class="word">${v.word}</div>
<div class="meaning">${v.meaning||""}</div>
<div class="icons">üîä <span onclick="speak('${v.word}',0.7)">üê¢</span></div>
`;
list.appendChild(d);
});
document.getElementById("total").innerText="Total vocabulary: "+vocab.length;
}

function speak(t,r){
let u=new SpeechSynthesisUtterance(t);
u.lang="en-US";
u.rate=r;
speechSynthesis.speak(u);
}

function toggleFav(i){
vocab[i].fav=!vocab[i].fav;
saveStorage();
render();
}

function toggleFavView(){
favOnly=!favOnly;
render();
}

function refreshList(){
document.getElementById("search").value="";
favOnly=false;
render();
}

function deleteAll(){
if(confirm("Delete all?")){
vocab=[];
saveStorage();
render();
}
}

function openAdd(){
editIndex=-1;
document.getElementById("m_word").value="";
document.getElementById("m_meaning").value="";
document.getElementById("modal").style.display="flex";
}

function editWord(i){
editIndex=i;
document.getElementById("m_word").value=vocab[i].word;
document.getElementById("m_meaning").value=vocab[i].meaning;
document.getElementById("modal").style.display="flex";
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

function saveWord(){
let w=document.getElementById("m_word").value.trim();
let m=document.getElementById("m_meaning").value.trim();
if(!w)return;
if(editIndex>=0){
vocab[editIndex].word=w;
vocab[editIndex].meaning=m;
}else{
vocab.push({word:w,meaning:m,fav:false});
}
saveStorage();
closeModal();
render();
}

function importCSV(){
let inp=document.createElement("input");
inp.type="file";
inp.accept=".csv";
inp.onchange=e=>{
let f=e.target.files[0];
let r=new FileReader();
r.onload=ev=>{
let lines=ev.target.result.split("\n");
vocab=[];
lines.forEach(l=>{
let c=l.split(",");
if(c.length>=2){
vocab.push({word:c[0],meaning:c[1],fav:false});
}
});
saveStorage();
render();
alert("Import success");
};
r.readAsText(f);
};
inp.click();
}

function exportCSV(){
let csv=vocab.map(v=>`${v.word},${v.meaning}`).join("\n");
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv]));
a.download="vocab.csv";
a.click();
}

function openPron(){
document.getElementById("pronModal").style.display="flex";
}

function closePron(){
document.getElementById("pronModal").style.display="none";
document.getElementById("pronResult").innerText="";
}

function hearPron(){
let w=document.getElementById("pronInput").value;
speak(w,1);
}

function testPron(){
let w=document.getElementById("pronInput").value;
let rec=new webkitSpeechRecognition();
rec.lang="en-US";
rec.start();
rec.onresult=e=>{
let said=e.results[0][0].transcript.toLowerCase();
if(said==w.toLowerCase()){
document.getElementById("pronResult").innerText="‚úî Correct";
}else{
document.getElementById("pronResult").innerText="‚úò "+said;
}
};
}

render();
</script>
</body>
</html>